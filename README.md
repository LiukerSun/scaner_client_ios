# 扫码器 (Scanner)

一个功能强大的iOS扫码应用，支持多种条码格式，具有自动发送到服务器的功能。

## 功能特性

### 🔍 扫码功能
- **多格式支持**: QR码、Code128、Code39、EAN13、EAN8、UPCE、Code93、PDF417、Aztec
- **防重复扫码**: 2秒内相同条码自动忽略，避免重复扫描
- **闪光灯支持**: 在暗光环境下可启用闪光灯辅助扫码
- **振动反馈**: 扫码成功时提供振动反馈

### 📱 用户界面
- **简洁设计**: 现代化的SwiftUI界面设计
- **历史记录**: 实时显示扫码历史，按时间倒序排列
- **状态指示**: 清晰显示扫码成功/失败状态
- **统计信息**: 显示总扫码次数

### ⚙️ 设置功能
- **服务器配置**: 可自定义API接口地址
- **闪光灯控制**: 可选择是否启用闪光灯功能
- **持久化设置**: 设置自动保存到本地

### 🔄 自动发送
- **静默发送**: 扫码后自动发送到配置的服务器
- **状态跟踪**: 实时显示发送状态（发送中/成功/失败）
- **错误处理**: 完善的网络错误处理机制

## 技术架构

### 开发环境
- **平台**: iOS 14.0+
- **语言**: Swift 5.0
- **框架**: SwiftUI + AVFoundation
- **最低版本**: iOS 14.0

### 核心组件
- `ContentView`: 主界面视图
- `SettingsView`: 设置界面
- `CodeScannerView`: 扫码界面
- `ScannerViewController`: 相机控制逻辑

## 安装与使用

### 环境要求
- Xcode 12.0+
- iOS 14.0+
- 支持相机的iOS设备

### 安装步骤
1. 克隆项目到本地
2. 使用Xcode打开 `scaner.xcodeproj`
3. 选择目标设备或模拟器
4. 点击运行按钮

### 首次使用
1. 打开应用后，点击右上角的设置图标
2. 在设置页面配置服务器API地址
3. 可选择启用闪光灯功能
4. 保存设置后返回主界面
5. 点击"开始扫描"按钮开始扫码

## 配置说明

### 服务器设置
- **API地址**: 输入完整的HTTP/HTTPS接口地址
- **示例**: `http://192.168.50.128:5000`
- **数据格式**: 应用会自动发送JSON格式的数据

### 发送数据格式
```json
{
  "code": "扫描到的条码内容",
  "timestamp": 1640995200.0,
  "device_info": "iOS Device"
}
```

### 扫码设置
- **闪光灯**: 在暗光环境下可启用，整个扫码过程保持开启
- **防重复**: 2秒内相同条码自动忽略

## 使用流程

1. **启动扫码**: 点击"开始扫描"按钮
2. **对准条码**: 将相机对准要扫描的条码
3. **自动处理**: 扫码成功后自动发送到服务器
4. **查看结果**: 在主界面查看扫码历史和状态
5. **重复扫码**: 需要再次扫码时重新点击按钮

## 项目结构

```
scaner/
├── scaner/
│   ├── Assets.xcassets/          # 应用图标和资源
│   ├── ContentView.swift         # 主界面视图
│   └── scanerApp.swift          # 应用入口
├── scaner.xcodeproj/            # Xcode项目文件
├── scanerTests/                 # 单元测试
└── scanerUITests/               # UI测试
```

## 主要功能模块

### 扫码模块
- 使用AVFoundation框架实现相机控制
- 支持多种条码格式识别
- 实时预览和扫码反馈

### 网络模块
- 异步HTTP请求发送扫码数据
- 完善的错误处理和状态管理
- 支持自定义服务器地址

### 数据管理
- 本地存储扫码历史记录
- 用户设置持久化
- 防重复扫码机制

## 注意事项

1. **权限要求**: 首次使用需要授权相机访问权限
2. **网络连接**: 确保设备连接到网络以发送数据
3. **服务器配置**: 请确保配置的API地址正确且可访问
4. **闪光灯**: 仅在支持的设备上可用

## 开发说明

### 添加新的条码格式
在 `ContentView.swift` 中的 `codeTypes` 数组添加新的格式：
```swift
codeTypes: [
    .qr, .code128, .code39, .ean13, .ean8, .upce, .code93, .pdf417, .aztec,
    // 添加新的格式
]
```

### 修改发送数据格式
在 `sendCodeToServer` 方法中修改 `requestBody` 字典：
```swift
let requestBody: [String: Any] = [
    "code": code,
    "timestamp": Date().timeIntervalSince1970,
    "device_info": "iOS Device",
    // 添加新的字段
]
```